---
- hosts: localhost
  tags:
    - classic
  tasks:
    - dnf:
        name: "*"
        state: latest

- hosts: localhost
  tags:
  - classic
  pre_tasks:
  - import_role:
      name: standard-test-source
    vars:
      fetch_only: True

  roles:
  - role: standard-test-basic
    tags:
      - classic
    required_packages:
      - rpm
      # build-self
      - dnf
      - rpm-build
      # clang/fedora-flags
      - clang
      #gcc-fedora-flags
      - gcc
      - gcc-c++
      - annobin-annocheck
      #auto-set-build-flags
      - gcc
      - gcc-c++
      - annobin-annocheck
      - make
      # no-new-dependency
      - diffutils
      - grep
    repositories:
      - repo: https://src.fedoraproject.org/tests/clang.git
        dest: clang
    tests:
      - build-self:
          dir: .
          run: "dnf -y build-dep {{ tenv_workdir }}/redhat-rpm-config.spec && rpmbuild --define '_sourcedir {{ tenv_workdir }}' -ba {{ tenv_workdir }}/redhat-rpm-config.spec"
      - clang/fedora-flags
      - gcc-fedora-flags
      - no-new-dependency
      - auto-set-build-flags
